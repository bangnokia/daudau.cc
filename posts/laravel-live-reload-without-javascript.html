<!DOCTYPE html>
<html lang="en">
<head>
	<title>Laravel live reloading without any js stuff | daudau's blog</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Do you know that we can implement live reload in Laravel without any npm package. No &lt;code&gt;browser sync&lt;/code&gt;, &lt;code&gt;no nodejs&lt;/code&gt;, just &lt;code&gt;php&lt;/code&gt;.">
	<link rel="icon" type="image/png" href="/images/favicon-32x32.png">
    <link rel="stylesheet" type="text/css" href="/css/app.css?v=1617122492">
    <link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400&display=swap" rel="stylesheet">
            <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.6.0/styles/default.min.css">
    </head>
<body>
	<div class="main-body mx-auto flex flex-col min-h-screen px-5 pt-5 max-w-2xl">
		 <div class="flex space-x-5 flex-none">
	<a href="/" class="text-gray-500 hover:underline">Home</a>
    <a href="/open-source.html" class="text-gray-500 hover:underline">Open source</a>
</div>
 

		<div class="mt-20 flex-grow flex-shrink flex-1">
			<div id="post">
	    <h1 class="text-cyan-600 text-3xl mb-5 font-bold">Laravel live reloading without any js stuff</h1>
	    <div class="text-gray-400">
            <span>Published on</span>
            <time datetime="2021-03-24">
                Mar 24th 2021
            </time>
        </div>

        <div class="relative block">
            <div class="post-content mt-5 leading-7 post-content font-light text-lg box-border break-words">
                <p>Do you know that we can implement live reload in Laravel without any npm package. No <code>browser sync</code>, <code>no nodejs</code>, just <code>php</code>.</p>
<p>Self claim, i don't like nodejs xD, and i don't know nodejs too xD. And if you read to here, you got click bait xD, we actually need a bit javascript. Sometimes working with laravel livewire, live reloading is really helpful, and i don't feel good if i have to install something like browsersync or some js stuff. So let do it with PHP</p>
<h2 id="how-live-reloading-works">How live reloading works</h2>
<p>First we need a <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers">websocket server</a>, but we don't have to write it by ourself, thankfully <a href="https://reactphp.org/">ReactPHP</a> and <a href="http://socketo.me/">Rachet</a>.</p>
<p>And in browser, some how it need to listen the websocket server, and reload the browser when the server told it to do.</p>
<p>Finally we also need file watchers, it watchs the files changing when we editing project, then tell websocket server send command tell the websocket client in browser reloads the url.</p>
<h2>Laravel implement</h2>
<p>My purpose is integrate in the the <code>php artisan serve</code> command, i think it's convenient and simple to use.</p>
<p>So i overwrite the <a href="https://github.com/bangnokia/laravel-serve-livereload/blob/84d9689444652ca8ab687e74b5c7bf65e04696b0/src/Commands/ServeCommand.php">ServeCommand</a> class. This command now spawn 2 processes:</p>
<ul>
<li>The default <code>artisan serve</code> from laravel, which now be <code>artisan serve:http</code>.</li>
<li>The websocket server <code>artisan serve:websockets</code>.</li>
</ul>
<p>The customization actually comes from <code>server:websockets</code> command. It's also spawn a file watcher, it watchs files changing every 500ms, and trigger the reload command to websocket server, then sending to all the listening clients.</p>
<p>And the file watcher also do a stupid task is writing a cache parameter</p>
<pre><code class="language-php">Cache::put('serve_websockets_running', true, 5);</code></pre>
<p>This can help us detect is that websocket server is running or not. I thin 5 seconds is ok. So we can inject the script to the html response via laravel middleware. Just put at the very begining of html response, doesn't look good but it works.</p>
<pre><code class="language-php">public function injectScripts($content)
{
    $content = (string) view('serve_livereload::script', [
        'host' =&gt; '127.0.0.1',
        'port' =&gt; ServeWebSocketsCommand::port(),
    ]).$content;

    return $content;
}</code></pre>
<p>And this is <a href="https://github.com/bangnokia/laravel-serve-livereload">laravel-server-livereload</a> package. Thank you for reading my explaination.</p>
            </div>
            <div class="absolute top-0 right-0 h-full z-0">
                 <div class="fixed hidden lg:block fixed" x-data="makeData()">
    <div class="table-of-contents w-96 sticky top-0 right-0 pt-5 pl-5">
        <ol class="list-decimal list-inside">
            <template x-for="item in items" :key="item.id">
                <li class="transition text-gray-300 hover:text-gray-500">
                    <a x-bind:href="`#${item.id}`" x-text="item.label" class="transition text-gray-300 hover:no-underline hover:text-gray-500"></a>
                </li>
            </template>
        </ol>
    </div>
</div>

 
            </div>
        </div>

	    <!-- tags -->
	    	</div>
		</div>

		<footer class="text-sm flex justify-end h-12 border-t pt-3 mt-10 space-x-2">
			<a href="https://github.com/bangnokia" title="github">my github</a>
			<span>|</span>
			<a href="/wakatime.html">wakatime</a>
			<span>|</span>
			<p>crafted by <a href="http://github.com/bangnokia/pekyll" target="_blank">pekyll</a> with ❤️.</p>
		</footer>
	</div>

    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.1/dist/alpine.min.js" defer></script>
    <script>
        function makeData() {
            const elements = document.querySelectorAll('h2');
            const items = [...elements].map(function (ele) {
                return {
                    id: ele.getAttribute('id'),
                    label: ele.textContent
                };
            });
            return {
                items: items
            };
        }
    </script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@10.6.0/highlight.min.js"></script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@10.6.0/languages/php.min.js"></script>
        <script>hljs.highlightAll();</script>
    
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-37232412-22"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	  gtag('config', 'UA-37232412-22');
	</script>
</body>
</html>
 
